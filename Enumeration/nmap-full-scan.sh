#!/usr/bin/env bash
#set -x
if [[ -z "$1"  ||  -z "$2" ]]; then
    echo "Usage: sudo ./nmap-full-scan <RHOSTS> <MIN-RATE>"
    exit 1
fi
# ports=$(nmap -sS $1 -p- --min-rate=$2 | awk -F '/' '/open/ {print $1}')
echo "nmap -sS $1 -p- --min-rate=$2"
res=$(nmap -sS $1 -p- --min-rate=$2 | tee /dev/tty)

ports=$(awk -F '/' '/open/ {print $1}' <<< "$res")

commaports=$(echo $ports | sed 's/ /,/g')
echo
echo -e "nmap -sV $1 -p$commaports"
nmap -sV $1 -p$commaports
